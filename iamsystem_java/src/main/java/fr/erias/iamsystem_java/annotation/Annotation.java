package fr.erias.iamsystem_java.annotation;

import java.util.Collection;
import java.util.List;

import fr.erias.iamsystem_java.brat.IBratFormatterF;
import fr.erias.iamsystem_java.keywords.IKeyword;
import fr.erias.iamsystem_java.tokenize.IToken;
import fr.erias.iamsystem_java.tokenize.ITokenizer;
import fr.erias.iamsystem_java.tree.INode;

/**
 * Matcher output.
 *
 * @author Sebastien Cossin
 */
public class Annotation extends Span implements IAnnotation
{

	public static IPrintAnnot printAnnot = new PrintAnnot();

	/**
	 * Change Brat Formatter to change text-span and offsets.
	 *
	 * @param bratFormatter A Brat formatter to produce a different Brat annotation.
	 */
	public static void setBratFormatter(IBratFormatterF bratFormatter)
	{
		Annotation.printAnnot = new PrintAnnot(bratFormatter);
	}

	/**
	 * Change toString() of every annotation (visitor pattern).
	 *
	 * @param printAnnot {@link IPrintAnnot} a class to print annotation.
	 */
	public static void setPrintAnnot(IPrintAnnot printAnnot)
	{
		Annotation.printAnnot = printAnnot;
	}

	private final List<Collection<String>> algos;
	private final INode node;
	private final List<IToken> stopTokens;
	private String text;

	/**
	 * Create an annotation
	 *
	 * @param tokens     a sequence of generic tokens generated by a
	 *                   {@link ITokenizer}
	 * @param algos      for each token, the list of algorithms that matched.
	 * @param node       a final state of iamsystem algorithm containing the keyword
	 *                   that matched this sequence of tokens.
	 * @param stopTokens the list of stopwords tokens of the document.
	 */
	public Annotation(List<IToken> tokens, List<Collection<String>> algos, INode node, List<IToken> stopTokens)
	{
		super(tokens);
		this.algos = algos;
		this.node = node;
		this.stopTokens = stopTokens;
	}

	@Override
	public int compareTo(IAnnotation o)
	{
		int diffStart = this.start() - o.start();
		if (diffStart != 0)
		{
			return diffStart;
		} else
		{
			return this.end() - o.end();
		}
	}

	@Override
	public List<Collection<String>> getAlgos()
	{
		return algos;
	}

	@Override
	public Collection<IKeyword> getKeywords()
	{
		return node.getKeywords();
	}

	@Override
	public String getText()
	{
		return text;
	}

	@Override
	public INode lastState()
	{
		return this.node;
	}

	@Override
	public void setText(String text)
	{
		this.text = text;
	}

	@Override
	public List<IToken> stopTokens()
	{
		return stopTokens;
	}

	@Override
	public String toString()
	{
		return Annotation.printAnnot.toString(this);
	}
}
